<!doctype html>
<html lang="zh-CN">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">

    <title>Satania标签自助系统</title>
</head>

<body style="background-color: #f5f5f5;padding-top: 40px; padding-bottom: 40px;">
    <div class="container">
        <div class="accordion" id="accordionExample">



            <div class="card">
                <div class="card-header p-2 collapsed" id="heading1" data-toggle="collapse" data-target="#collapse1"
                    aria-expanded="false" aria-controls="collapse1">


                    <div class="row">

                        <div class="col-6 text-truncate">
                            #1
                            <span class="badge badge-primary">简单</span>
                            <span class="badge badge-success">可编辑</span>
                            关键词1 关键词2 关键词3 关键词4 关键词5 关键词6 关键词7 关键词8 关键词9
                        </div>

                        <div class="col text-truncate font-italic" style="color:lightgray;">
                            // 注释黑暗大法师黑暗大法师黑暗大法师黑暗大法师黑暗大法师黑暗大法师黑暗大法师黑暗大法师
                        </div>

                        <div class="col-1">
                            <span class="badge badge-secondary float-right mt-1">黑暗大法师</span>
                        </div>
                    </div>

                </div>

                <div id="collapse1" class="collapse" aria-labelledby="heading1" data-parent="#accordionExample">
                    <div class="card-body">

                        <div class="row">
                            <div class="col">
                                <label>匹配规则</label>
                                <br>
                                <!-- <input type="text" class="form-control"> -->
                                <button type="button" class="btn btn-outline-info mb-1">关键词1</button>
                                <button type="button" class="btn btn-outline-info mb-1">关键词2</button>
                                <button type="button" class="btn btn-outline-info mb-1">关键词3</button>
                                <button type="button" class="btn btn-outline-info mb-1">关键词4</button>
                                <button type="button" class="btn btn-outline-info mb-1">关键词5</button>
                                <button type="button" class="btn btn-outline-info mb-1">关键词6</button>
                                <button type="button" class="btn btn-outline-info mb-1">关键词7</button>
                                <button type="button" class="btn btn-outline-info mb-1">关键词8</button>
                                <button type="button" class="btn btn-outline-info mb-1">关键词9</button>
                                <button type="button" class="btn btn-info mb-1">新增...</button>
                            </div>

                            <div class="col-4">
                                <label>匹配类型</label>
                                <br>
                                <button class="btn btn-info dropdown-toggle" type="button" id="dropdownMenuButton"
                                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    简单
                                </button>
                                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                    <button class="dropdown-item">简单</button>
                                    <button class="dropdown-item">正则</button>
                                </div>
                            </div>
                        </div>

                        <br>

                        <div class="row">
                            <div class="col">
                                <label>对应标签</label>
                                <br>
                                <button type="button" class="btn btn-outline-info mb-1">标签1</button>
                                <button type="button" class="btn btn-light px-2 mb-1 text-decoration-none">OR</button>
                                <button type="button" class="btn btn-outline-info mb-1">标签2</button>
                                <button type="button" class="btn btn-light px-2 mb-1 text-decoration-none">AND</button>
                                <button type="button" class="btn btn-outline-info mb-1">标签4</button>
                                <button type="button" class="btn btn-light px-2 mb-1 text-decoration-none">OR</button>
                                <button type="button" class="btn btn-outline-info mb-1">标签5</button>
                                <button type="button" class="btn btn-light px-2 mb-1 text-decoration-none">AND</button>
                                <button type="button" class="btn btn-outline-info mb-1">标签6</button>
                                <button type="button" class="btn btn-light px-2 mb-1 text-decoration-none">OR</button>
                                <button type="button" class="btn btn-outline-info mb-1">标签7</button>
                                <button type="button" class="btn btn-light px-2 mb-1 text-decoration-none">AND</button>
                                <button type="button" class="btn btn-outline-info mb-1">标签8</button>
                                <button type="button" class="btn btn-light px-2 mb-1 text-decoration-none">OR</button>
                                <button type="button" class="btn btn-outline-info mb-1">标签9</button>
                                <button type="button" class="btn btn-info mb-1">新增...</button>
                            </div>
                        </div>

                        <br>

                        <div class="row">
                            <div class="col">
                                <label>// 注释</label>
                                <br>
                                <input type="text" class="form-control"
                                    value="注释黑暗大法师黑暗大法师黑暗大法师黑暗大法师黑暗大法师黑暗大法师黑暗大法师黑暗大法师">
                            </div>
                        </div>

                        <br>

                        <div class="row">
                            <div class="col text-right">
                                <button type="button" class="btn btn-primary w-25">提交</button>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header p-2 collapsed" id="heading2" data-toggle="collapse" data-target="#collapse2"
                    aria-expanded="false" aria-controls="collapse2">

                    <div class="row">
                        <div class="col-6 text-truncate">
                            #2
                            <span class="badge badge-primary">正则</span>
                            <span class="badge badge-success">可编辑</span>
                            关键词1|关键词2
                        </div>

                        <div class="col text-truncate font-italic" style="color:lightgray;">

                        </div>

                        <div class="col-1">
                            <span class="badge badge-secondary float-right mt-1">黑暗大法师</span>
                        </div>
                    </div>

                </div>

                <div id="collapse2" class="collapse" aria-labelledby="heading2" data-parent="#accordionExample">
                    <div class="card-body">

                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header p-2 collapsed" id="heading3" data-toggle="collapse" data-target="#collapse3"
                    aria-expanded="false" aria-controls="collapse3">

                    <div class="row">
                        <div class="col text-truncate text-right">
                            <button type="button" class="btn btn-primary btn-sm">新增...</button>
                        </div>
                    </div>

                </div>

                <div id="collapse3" class="collapse" aria-labelledby="heading3" data-parent="#accordionExample">
                    <div class="card-body">

                    </div>
                </div>
            </div>


        </div>

        <div class="accordion" id="userTagList"></div>
    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="js/jquery-3.4.1.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>

    <!-- 萨塔妮娅API -->
    <script src="js/satania.api.js"></script>

    <script>
        function addCard(parent, userTag) {
            let type;
            switch (userTag.type) {
                case 'regexp':
                    type = '正则';
                    break;
                case 'string':
                    type = '简单';
                    break;
                default:
                    type = '未知'
                    break;
            }

            const card = $(
                '<div class="card">' +
                `<div class="card-header p-2 collapsed" id="heading${userTag.id}" data-toggle="collapse" data-target="#collapse${userTag.id}" aria-expanded="false" aria-controls="collapse${userTag.id}">` +
                '<div class="row">' +
                '<div class="col-6 text-truncate">' +
                `#${userTag.id}` +
                `<span class="badge badge-primary">${type}</span>` +
                (userTag.editable ? '<span class="badge badge-success">可编辑</span>' : '') +
                `<div class="col text-truncate font-italic" style="color:lightgray;">// ${userTag.comment}</div>` +
                `<div class="col-1"><span class="badge badge-secondary float-right mt-1">${userTag.userName}</span></div>` +
                `<div id="collapse${userTag.id}" class="collapse" aria-labelledby="heading${userTag.id}" data-parent="#${parent.attr('id')}">` +
                '<div class="card-body"></div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>'
            );

            parent.append(card);
        }

        function updateUserTagsList(userTags) {
            const userTagList = $('#userTagList');
            const userTagListChildren = userTagList.children();
            for (let i = userTagListChildren.length - 1; i >= 0; i--) {
                userTagListChildren[i].remove();
            }
            for (const userTag of userTags) {
                addCard(userTagList, userTag);
            }
        }
    </script>

    <script>
        const searchParams = new URLSearchParams(window.location.search);

        $(document).ready(async () => {
            // 获得用户标签
            let response = await SataniaAPI.getUserTags(searchParams.get('key'));
            updateUserTagsList(response);
        });
    </script>
</body>